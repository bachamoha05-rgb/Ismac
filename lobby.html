<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ISMAC - Salle d'attente</title>
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<h1>Salle <span id="codeSalleDisplay"></span></h1>

<div>
    <h2>Joueurs dans la salle :</h2>
    <div id="listeJoueurs"></div>
</div>

<button id="pret">Je suis prêt</button>
<button id="start" style="display:inline-block;">Lancer la partie</button>

<script>
// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyA-VhnC4VBWXjl9POidNwGG8uLpibLqOwk",
  authDomain: "ismac-5c655.firebaseapp.com",
  databaseURL: "https://ismac-5c655-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ismac-5c655",
  storageBucket: "ismac-5c655.firebasestorage.app",
  messagingSenderId: "601300390094",
  appId: "1:601300390094:web:ba2d320c258ba0fde0c09f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- Infos session ---
let pseudo = sessionStorage.getItem("pseudo");
let codeSalle = sessionStorage.getItem("codeSalle");
let createur = sessionStorage.getItem("createur") === "true";

document.getElementById("codeSalleDisplay").innerText = codeSalle;

// --- Références Firebase ---
let salleRef = db.ref("salles/" + codeSalle);
let joueursRef = salleRef.child("joueurs");

// Ajouter le joueur
joueursRef.child(pseudo).set({pret:false, score:0});

// --- Liste joueurs + bouton lancer ---
joueursRef.on("value", snapshot => {
    const data = snapshot.val();
    const listeDiv = document.getElementById("listeJoueurs");
    listeDiv.innerHTML = "";

    for(let nom in data){
        let div = document.createElement("div");
        div.innerText = nom + (data[nom].pret ? " ✅" : " ❌");
        div.classList.add("new-player");
        listeDiv.appendChild(div);
    }

    // Bouton lancer toujours visible pour l'hôte
    if(!createur){
        document.getElementById("start").style.display = "none";
    } else {
        document.getElementById("start").style.display = "inline-block";
    }
});

// --- Bouton prêt ---
document.getElementById("pret").onclick = () => {
    joueursRef.child(pseudo).update({pret:true});
}

// --- Bouton lancer ---
document.getElementById("start").onclick = () => {
    salleRef.update({lancement:true});
}

// --- Détecter lancement ---
salleRef.on("value", snapshot => {
    const data = snapshot.val();
    if(data.lancement) window.location.href = "jeu.html";
});
</script>
</body>
</html>
